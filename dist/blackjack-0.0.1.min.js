/*! blackjack 0.0.1 2015-03-29 */
var Blackjack=Blackjack||{};Blackjack.Game=function(){"use strict";function Game(player,dealer,options){this.decks=options.numberOfDecks,this.dealerHitSoft17=options.dealerHitSoft17;var DEALER=dealer;this.dealer=new Dealer(DEALER);var PLAYER=player;this.player=new Player(PLAYER),this.shoe=[],this.turn=null}function Dealer(name){Player.call(this,name)}function Card(rank,suit){this.rank=rank,this.suit=suit}var SUITS=["♥","♦","♠","♣"],RANKS=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],HIT="Hit",STAND="Stand",SPLIT="Split",DOUBLE="Double",shuffle=function(){for(var j,swap,i=this.shoe.length;--i;)j=Math.random()*(i+1)|0,swap=this.shoe[i],this.shoe[i]=this.shoe[j],this.shoe[j]=swap},load=function(){this.shoe=[];for(var i=0;i<this.decks;i+=1)for(var j=0;j<SUITS.length;j++)for(var k=0;k<RANKS.length;k++)this.shoe.push(new Card(RANKS[k],SUITS[j]))},Player=function(){function Player(name){this.name=name,this.cards=[],this.actions=[],this.history=[]}return Player.prototype.getCards=function(){return this.cards},Player.prototype.canSplit=function(){if(this.prototype instanceof Player)return!1;var cards=this.cards;return 2===cards.length&&cards[0].rank===cards[1].rank?!0:!1},Player.prototype.canDouble=function(){return this.prototype instanceof Player?!1:0===this.history.length||this.history[this.history.length-1]===SPLIT?!0:!1},Player.prototype.getActions=function(){var total=Blackjack.Utils.score(this.cards);return this.actions=[],21>total&&(this.actions.push(HIT),this.actions.push(STAND)),this.canDouble.call(this)&&this.actions.push(DOUBLE),this.canSplit.call(this)&&this.actions.push(SPLIT),this.actions},Player}();return Dealer.prototype=Object.create(Player.prototype),Game.prototype.getTurn=function(){return this.turn},Game.prototype.setTurn=function(player){this.turn=player},Game.prototype.getShoe=function(player){return this.shoe},Game.prototype.getPlayer=function(){return this.player},Game.prototype.getDealer=function(){return this.dealer},Game.prototype.deal=function(){load.call(this),shuffle.call(this),this.player.cards.push(this.shoe.pop()),this.dealer.cards.push(this.shoe.pop()),this.player.cards.push(this.shoe.pop()),this.turn=this.player},Game}();var Blackjack=Blackjack||{};Blackjack.Probability=function(){"use strict";function init(){var stats={hands:0,win:{hands:0,odds:0},lose:{hands:0,odds:0},push:{hands:0,odds:0}};return stats}function combine(currentStats,newStats){return currentStats.hands+=newStats.hands,currentStats.win.hands+=newStats.win.hands,currentStats.win.odds+=newStats.win.odds,currentStats.lose.hands+=newStats.lose.hands,currentStats.lose.odds+=newStats.lose.odds,currentStats.push.hands+=newStats.push.hands,currentStats.push.odds+=newStats.push.odds,currentStats}var stand=function(shoe,dealerCards,playerCards,maxPullCount,pullCount,startIndex){for(var dealerTotalAfterPull,dealerCardsAfterPull,newStats,playerTotal=Blackjack.Utils.score(playerCards),stats=init(),i=0,j=pullCount+startIndex;i<shoe.length-pullCount;i+=1,j+=1){j=j>=shoe.length?0:j;for(var nextCard=shoe[pullCount>0?j:i],cardProbabilty=1,l=0;pullCount>=l;l+=1)cardProbabilty*=1/(shoe.length-l);dealerCardsAfterPull=dealerCards.slice(),dealerCardsAfterPull.push(nextCard),dealerTotalAfterPull=Blackjack.Utils.score(dealerCardsAfterPull),playerTotal>21?(stats.hands+=1,stats.lose.hands+=1,stats.lose.odds+=cardProbabilty):dealerTotalAfterPull>21?(stats.hands+=1,stats.win.hands+=1,stats.win.odds+=cardProbabilty):dealerTotalAfterPull>=17?(stats.hands+=1,playerTotal>dealerTotalAfterPull?(stats.win.hands+=1,stats.win.odds+=cardProbabilty):dealerTotalAfterPull>playerTotal?(stats.lose.hands+=1,stats.lose.odds+=cardProbabilty):(stats.push.hands+=1,stats.push.odds+=cardProbabilty)):maxPullCount>=pullCount&&(newStats=stand(shoe,dealerCardsAfterPull,playerCards,maxPullCount,pullCount+1,pullCount>0?startIndex:i),stats=combine(stats,newStats))}return stats},hit=function(shoe,dealerCards,playerCards,maxPullCount,pullCount,startIndex){for(var playerTotalAfterPull,playerCardsAfterPull,newStats,playerTotal=Blackjack.Utils.score(playerCards),stats=init(),i=0,j=pullCount+startIndex;i<shoe.length-pullCount;i+=1,j+=1){j=j>=shoe.length?0:j;for(var nextCard=shoe[pullCount>0?j:i],cardProbabilty=1,l=0;pullCount>=l;l+=1)cardProbabilty*=1/(shoe.length-l);playerCardsAfterPull=playerCards.slice(),playerCardsAfterPull.push(nextCard),playerTotalAfterPull=0===pullCount&&21===playerTotal?playerTotal:Blackjack.Utils.score(playerCardsAfterPull),playerTotalAfterPull>=17?(newStats=stand(shoe,dealerCards,playerCardsAfterPull,maxPullCount,pullCount+1,0),stats=combine(stats,newStats)):maxPullCount>=pullCount&&(newStats=hit(shoe,dealerCards,playerCardsAfterPull,maxPullCount,pullCount+1,pullCount>0?startIndex:i),stats=combine(stats,newStats))}return stats},double=function(shoe,dealerCards,playerCards,maxPullCount,pullCount,startIndex){for(var playerCardsAfterPull,newStats,stats=(Blackjack.Utils.score(playerCards),init()),i=0,j=pullCount+startIndex;i<shoe.length-pullCount;i+=1,j+=1){j=j>=shoe.length?0:j;var nextCard=shoe[pullCount>0?j:i];playerCardsAfterPull=playerCards.slice(),playerCardsAfterPull.push(nextCard),newStats=stand(shoe,dealerCards,playerCardsAfterPull,maxPullCount,pullCount+1,0),stats=combine(stats,newStats)}return stats};return{stand:function(shoe,dealerCards,playerCards,maxPullCount){return stand(shoe,dealerCards,playerCards,maxPullCount,0,0)},hit:function(shoe,dealerCards,playerCards,maxPullCount){return hit(shoe,dealerCards,playerCards,maxPullCount,0,0)},"double":function(shoe,dealerCards,playerCards,maxPullCount){return double(shoe,dealerCards,playerCards,maxPullCount,0,0)}}}();var Blackjack=Blackjack||{};Blackjack.Utils={score:function(cards){for(var ace,value,sum=0,i=0;i<cards.length;i+=1)"J"===cards[i].rank||"Q"===cards[i].rank||"K"===cards[i].rank?value=10:"A"===cards[i].rank?(value=1,ace=!0):value=parseInt(cards[i].rank,10),sum+=value;return ace&&12>sum&&(sum+=10),sum}};